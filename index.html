<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ethnic Matching Cards Game</title>
<style>
  /* Reset */
  * {
    box-sizing: border-box;
    user-select: none;
  }
  body {
    background: linear-gradient(135deg, #f9f9f9, #e6e2d3);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 1rem;
    color: #333;
  }
  h1 {
    margin-bottom: 0.5rem;
    font-weight: 700;
    letter-spacing: 2px;
    font-size: 2rem;
  }
  #level-info {
    margin-bottom: 1rem;
    font-weight: 600;
  }
  #game {
    width: 420px;
    max-width: 95vw;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    perspective: 1000px;
  }

  .card {
    width: 100%;
    padding-top: 125%; /* 4:5 ratio */
    position: relative;
    cursor: pointer;
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 12px;
    box-shadow:
      inset 0 0 10px #f7f7f7,
      0 4px 6px rgba(0, 0, 0, 0.1);
    background: white;
  }
  .card.flipped {
    transform: rotateY(180deg);
    cursor: default;
  }

  /* Front & back faces */
  .card-face {
    position: absolute;
    inset: 0;
    border-radius: 12px;
    backface-visibility: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 3rem;
    font-weight: 700;
    box-shadow: 
      inset 0 0 5px rgba(0, 0, 0, 0.1);
  }

  /* Card front: white with ethnic design & ridges */
  .card-front {
    background: #fff;
    box-shadow:
      inset 0 4px 6px rgba(255, 255, 255, 0.8),
      inset 0 -4px 6px rgba(200, 180, 160, 0.15);
    border: 2px solid #c9a66b;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* Ridged effect using repeating linear gradient */
  .card-front::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background:
      repeating-linear-gradient(
        45deg,
        rgba(201, 166, 107, 0.1),
        rgba(201, 166, 107, 0.1) 4px,
        rgba(201, 166, 107, 0.15) 6px,
        rgba(201, 166, 107, 0.15) 10px
      );
    border-radius: 12px;
    z-index: 1;
  }

  /* "baiiqi" styled text as a design on the front */
  .card-front .design-text {
    font-family: 'Georgia', serif;
    font-size: 1.2rem;
    font-weight: 900;
    color: #c9a66b;
    text-align: center;
    text-shadow:
      1px 1px 0 #fff,
      2px 2px 3px rgba(201, 166, 107, 0.5);
    user-select: none;
    position: relative;
    z-index: 2;
    margin-top: auto;
    margin-bottom: 0.5rem;
  }

  /* Card back: show the emoji or icon */
  .card-back {
    background: #c9a66b;
    color: white;
    transform: rotateY(180deg);
    font-size: 2.8rem;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 12px;
    box-shadow:
      0 2px 10px rgba(0, 0, 0, 0.2);
  }

  /* Game info */
  #rounds-info {
    margin-top: 15px;
    font-weight: 600;
  }

  /* Button styles */
  button {
    margin-top: 20px;
    background: #c9a66b;
    border: none;
    padding: 10px 20px;
    color: white;
    font-weight: 700;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    transition: background 0.3s ease;
  }
  button:hover {
    background: #b18e44;
  }
</style>
</head>
<body>
  <h1>Ethnic Matching Cards</h1>
  <div id="level-info">Level: 1 / 3</div>
  <div id="game"></div>
  <div id="rounds-info">Rounds: 0 / 20</div>
  <button id="restart">Restart Game</button>

<script>
  // Card icons (using emojis for simplicity)
  const cardIcons = [
    '🐘', '🌺', '🦜', '🌿', '🛖', '🎋', '🔥', '🌙'
  ];

  // Game variables
  let cards = [];
  let flippedCards = [];
  let matchedPairs = 0;
  let rounds = 0;
  let level = 1;
  const maxRounds = 20;
  const maxLevels = 3;
  const totalCards = 16; // 8 pairs
  const gameContainer = document.getElementById('game');
  const roundsInfo = document.getElementById('rounds-info');
  const levelInfo = document.getElementById('level-info');
  const restartBtn = document.getElementById('restart');

  // Sound effects
  const sounds = {
    flip: new Audio('https://freesound.org/data/previews/341/341695_3248244-lq.mp3'),
    match: new Audio('https://freesound.org/data/previews/170/170144_2437358-lq.mp3'),
    shuffle: new Audio('https://freesound.org/data/previews/352/352664_5121236-lq.mp3'),
    win: new Audio('https://freesound.org/data/previews/276/276020_5121236-lq.mp3')
  };

  function playSound(name) {
    if (sounds[name]) {
      sounds[name].currentTime = 0;
      sounds[name].play();
    }
  }

  // Fisher-Yates Shuffle
  function shuffleArray(arr) {
    let array = arr.slice();
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Create the deck of cards (16 total, 8 pairs)
  function createDeck() {
    // Take first 8 icons
    let deck = cardIcons.slice(0, totalCards / 2);
    deck = deck.concat(deck); // duplicate for pairs
    deck = shuffleArray(deck);
    return deck;
  }

  // Render cards to the DOM
  function renderCards() {
    gameContainer.innerHTML = '';
    cards.forEach((icon, index) => {
      const card = document.createElement('div');
      card.classList.add('card');
      card.dataset.icon = icon;
      card.dataset.index = index;

      const cardFront = document.createElement('div');
      cardFront.classList.add('card-face', 'card-front');
      // Add ethnic style design text "baiiqi"
      const designText = document.createElement('div');
      designText.className = 'design-text';
      designText.textContent = 'baiiqi';
      cardFront.appendChild(designText);

      const cardBack = document.createElement('div');
      cardBack.classList.add('card-face', 'card-back');
      cardBack.textContent = icon;

      card.appendChild(cardFront);
      card.appendChild(cardBack);

      card.addEventListener('click', onCardClick);

      gameContainer.appendChild(card);
    });
  }

  function onCardClick(e) {
    const card = e.currentTarget;
    if (
      flippedCards.length === 2 ||
      card.classList.contains('flipped') ||
      card.classList.contains('matched')
    ) return;

    flipCard(card);
    playSound('flip');

    flippedCards.push(card);

    if (flippedCards.length === 2) {
      rounds++;
      roundsInfo.textContent = `Rounds: ${rounds} / ${maxRounds}`;
      checkMatch();
    }
  }

  function flipCard(card) {
    card.classList.add('flipped');
  }

  function unflipCards() {
    flippedCards.forEach(card => card.classList.remove('flipped'));
    flippedCards = [];
  }

  function checkMatch() {
    const [card1, card2] = flippedCards;
    if (card1.dataset.icon === card2.dataset.icon) {
      // Matched
      matchedPairs++;
      card1.classList.add('matched');
      card2.classList.add('matched');
      playSound('match');
      flippedCards = [];

      if (matchedPairs === totalCards / 2) {
        setTimeout(() => {
          playSound('win');
          alert(`🎉 Level ${level} Complete!`);
          if (level < maxLevels) {
            level++;
            startLevel(level);
          } else {
            alert('🎉 You completed all levels! Great job!');
            resetGame();
          }
        }, 500);
      }
    } else {
      // Not matched, flip back after delay
      setTimeout(() => {
        unflipCards();
      }, 1200);
    }

    // Check for shuffle condition if max rounds reached and game not finished
    if (rounds >= maxRounds && matchedPairs < totalCards / 2) {
      shuffleCards();
    }
  }

  function shuffleCards() {
    playSound('shuffle');
    alert('Too many rounds! Shuffling cards...');
    rounds = 0;
    roundsInfo.textContent = `Rounds: ${rounds} / ${maxRounds}`;

    // Shuffle card icons and update dataset.icon for each card
    cards = shuffleArray(cards);

    // Update DOM cards accordingly, keeping matched cards flipped and disabled
    const cardDivs = [...document.querySelectorAll('.card')];
    cardDivs.forEach((cardDiv, index) => {
      cardDiv.dataset.icon = cards[index];
      cardDiv.querySelector('.card-back').textContent = cards[index];
      if (!cardDiv.classList.contains('matched')) {
        cardDiv.classList.remove('flipped');
        cardDiv.style.pointerEvents = 'auto';
      }
    });

    flippedCards = [];
  }

  function startLevel(lvl) {
    matchedPairs = 0;
    rounds = 0;
    cards = createDeck();
    levelInfo.textContent = `Level: ${lvl} / ${maxLevels}`;
    roundsInfo.textContent = `Rounds: ${rounds} / ${maxRounds}`;
    renderCards();
  }

  function resetGame() {
    level = 1;
    startLevel(level);
  }

  restartBtn.addEventListener('click', resetGame);

  // Start the game
  resetGame();
</script>
</body>
</html>
